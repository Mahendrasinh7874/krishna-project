<!DOCTYPE html>
<html>

<head>
    <title>Payment</title>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>

<body>
    <button id="rzp-button1" class="btn btn-primary">Pay with Razorpay</button>

    <script>
        document.addEventListener('DOMContentLoaded', function () {

            var options = {
                "key": "{{ razorpay_merchant_key }}", // Your Razorpay key
                "amount": "{{ amount_in_paise }}", // Amount in paise
                "currency": "INR",
                "name": "Your Company Name",
                "description": "Payment for Order",
                "order_id": "{{ order_id }}", // Order ID generated by Razorpay
                "handler": function (response) {
                    // Handle the response
                    fetch("{% url 'payment_success' %}", {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify({
                            razorpay_payment_id: response.razorpay_payment_id,
                            razorpay_order_id: response.razorpay_order_id,
                            razorpay_signature: response.razorpay_signature
                        })
                    })
                        .then(response => {
                            if (response.ok) {
                                window.location.href = "{% url 'Getorder' %}";
                            } else {
                                window.location.href = "{% url 'payment-failed' %}";
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            window.location.href = "{% url 'payment-failed' %}";
                        });
                },
                "prefill": {
                    "name": "{{ request.user.username }}",
                    "email": "{{ request.user.email }}"
                },
                "theme": {
                    "color": "#3399cc"
                },
                "modal": {
                    "ondismiss": function () {
                        window.location.href = "{% url 'show-cart' %}";
                    }
                }
            };

            var rzp1 = new Razorpay(options);
            document.getElementById('rzp-button1').onclick = function (e) {
                rzp1.open();
                e.preventDefault();
            };
        });
    </script>
</body>

</html>